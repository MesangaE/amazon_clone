<<<<<<< HEAD
<h1>amazon_clone</h1>

![image](https://github.com/user-attachments/assets/ae121445-b862-4c10-a109-81e1e6367603)

Today we will deploy the Amazon app in AWS ec2 using Terraform as an infrastructure-building tool. Then we automate the whole process using Jenkins which allows us continuous integration and continuous deployment (ci-cd) and then we set up Prometheus and Grafana for monitoring. To start this project, I decided to first clone the repo into my local and do modifications on the Terraform files (region, ami, I created a new keypair as well so I added that resource to the resource block)

=======
Deployment of Amazon clone app using Terraform and Jenkins ci-cd

Pre-requisite
AWS account
basics of terraform and Jenkins

Let's do it
before doing anything →
open your terminal and make a separate folder for Amazon →mkdir amazon
cd amazon
clone the GitHub repo
git clone https://github.com/Aakibgithuber/Amazon-app-Deployment-using-terraform-and-jenkins.git

<h3>STEPS</h3>
<h3>Step 1: Setup Terraform and configure aws on your local machine</h3>
  sudo su
  sudo apt update && sudo apt upgrade -y
  sudo apt install wget -y
  wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg
  echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee 
  /etc/apt/sources.list.d/hashicorp.list
  sudo apt update && sudo apt install terraform
  which terraform (/usr/bin/terraform)

  <h2>create an IAM user</h2>
  
  go to IAM on the console and click users
  Give your user a name, check the Provide user access to the management console, and then click on I want an IAM user option.

  ![Clonemesangauser](https://github.com/user-attachments/assets/787785a7-a10c-438b-bb42-ddbd27af70bd)

  
  choose a password for your user →click next
  Attach the policies directly to your IAM user → click next
  click on Create user


  ![cloneuser2](https://github.com/user-attachments/assets/7c08df31-2558-4469-9ab0-9a25fd01358d)


  ![cloneuser3](https://github.com/user-attachments/assets/d389e3f0-364c-4b7b-ae72-7cb4f7718775)


  download your password file if it is autogenerated otherwise it is your choice

  ![cloneuser4](https://github.com/user-attachments/assets/c20924a6-7a56-4983-bd0d-ce7724e7a775)

 
  Click on your newly created  IAM user →security credentials


 ![cloneuser5](https://github.com/user-attachments/assets/9079878b-388e-4b3e-95c7-7a20a9b65b79)

  
  
  scroll down to access keys and create an access keys


  ![clone user 6](https://github.com/user-attachments/assets/d6094bbc-3ac4-40e0-b4ec-2f3d2ca21f29)

  

  choose aws cli from the options listed



  ![cloneuser7](https://github.com/user-attachments/assets/c7705aa3-b164-4155-95dc-f90a64f0fb34)
  

  click next and download your CSV file for username and password

  

 ![cloneuser](https://github.com/user-attachments/assets/dd45f7dd-edc1-4dcf-a7d1-7866e38051cd)


  <br>
  go to your terminal and configure AWS with these user credentials

  ---bash
      sudo apt install awscli 
      aws configure
  ---


  ![configureaws](https://github.com/user-attachments/assets/5b8efb5a-400e-4f62-b5ea-de84457c6e2f)


  note →I will provide the administrator access for now but we are careful while attaching the policies on your workspace

  </br>
  
<h3>Step 2: Building a simple Infrastructure from code using Terraform</h3>

 cd JENKINS-TF

 ![main tfmodify](https://github.com/user-attachments/assets/cf66f730-928e-4018-ae45-b2bbf7e70301)



 ![newresources](https://github.com/user-attachments/assets/0ffcc126-2d50-43b7-bc4b-a43ea7ca5203)

 


modify the Main.tf file, with ami ID, key name, and region in the Provider.tf. I cloned the repo into my local and did the modifications and also changed the name of the repo before I pushed it to my Github and I cloned my modified repo.

main.tf includes user data which links install_jenkins.sh file on which execution install Jenkins,docker,trivy, and start the sonarqube container on port 9000


![initS](https://github.com/user-attachments/assets/1684f705-e5f4-4c77-94ca-5b3845b91e45)



so I decided to create a new key for the instance. so I added 2 resource blocks and I wanted also the mistakes that I made to be included in this screenshot. I had a typo when I was referring to the attribute local_file. It is always good to validate your terraform configuration before you plan. Instead of 3 resources in the original demo, I had 5 resources planned.


![validateS](https://github.com/user-attachments/assets/dd92bacd-a039-4af7-bc6d-0e4a31e4155d)


![applyS](https://github.com/user-attachments/assets/b010688c-d0cf-46e2-bc39-fdedd0bd9c0d)


![applyS1](https://github.com/user-attachments/assets/de806c08-4401-445c-897d-38a7a1b73875)



![applyS2](https://github.com/user-attachments/assets/7bfbe734-0575-4038-8900-afdeb1949c2b)



Rem that anytime you add another resource. In my case, I had to add the provider tls and needed to initialize it again. I had a lot of issues adding resource blocks for a keypair because arguments I had used before had become deprecated. Documentation is one place to get all the information you need.
 
<h2>Step 3: Setup Sonarqube and Jenkins</h2>
1. Sonarqube setup
copy the public IP of your machine paste it into the browser and add the port number, <publicip>:9000. Initial username and password are admin
one of the instances created by the terraform file. 


![sonar1](https://github.com/user-attachments/assets/008e6a34-aeb5-4a03-a060-072caa1d4238)

![sonar2](https://github.com/user-attachments/assets/007bc7d5-0e47-443f-b6ca-4aedf326bfe9)

![sonar3](https://github.com/user-attachments/assets/23be312e-e6a6-4f92-84b1-28328e4d89e0)

![sonar4](https://github.com/user-attachments/assets/7ddc697d-68d4-454a-acbc-e46cd8973ac8)



2. Jenkins setup
i had to use EC2 connnect to ssh into this instance because i didnt have the private keypair file on the server i was using


![jenkins1](https://github.com/user-attachments/assets/133726af-32a6-44ae-a735-dc9f1828d315)



![jenkinsa](https://github.com/user-attachments/assets/682ff18c-4475-4d0a-bcec-da97ec89c5d4)


![jenkins3](https://github.com/user-attachments/assets/4d7ecd8e-e478-443a-9db0-8314b6a2406b)


![jenkins4](https://github.com/user-attachments/assets/5b569093-dce0-46cd-8a76-ad79e1d1fbf5)


![jenkins5](https://github.com/user-attachments/assets/856750ac-94b2-4bb4-ab60-1b71f76fa2b7)




![jenkins6](https://github.com/user-attachments/assets/d7fa8967-2827-45f0-bf42-a016a0846627)





<h2>Step 4: ci-cd pipeline</h2>

1. Install Plugins listed below
 Eclipse Temurin Installer (Install without restart)

SonarQube Scanner (Install without restart)

NodeJs Plugin (Install Without restart)

 owasp →The OWASP Plugin in Jenkins is like a “security assistant” that helps you find and fix security issues in your software. It uses the knowledge and guidelines from the Open Web Application Security Project (OWASP) to scan your web applications and provide suggestions on security enhancement. It’s a tool to ensure that your web applications are protected against common security threats and vulnerabilities.

 Prometheus metrics →to monitor Jenkins on Grafana dashboard

 Download all the docker-related plugins

2. add credentials of Sonarqube and Docker
1st we generate a token for Sonarqube to use in Jenkins credentials as secret text

a. setup sonarqube credentials
go to http://publicip:9000
now enter your username and password
click on security →users →token →generate token
token_name==jenkins

3. Now we are going to setup tools for jenkins
go to manage jenkins → tools

a. add jdk
click on add jdk and select installer adoptium.net
choose jdk 17.0.8.1+1version and in name section enter jdk 17


go to manage jenkins →Configure global setting →add sonarqube servers
name ==sonar-server
server_url==http://public_ip:9000
server authentication token == jenkins →it is created in sonarqube security configurations




<h2>Step5:  Monitering via Prmotheus and grafana</h2>
<h2>Step 6: Terraform Destroy</h2>

My blog link for this project-->https://aakibkhan1.medium.com/project-7-deployment-of-amazon-clone-app-using-terraform-and-jenkins-ci-cd-32483787ea67
                
>>>>>>> master
